# 지하철 노선도 미션
[ATDD 강의](https://edu.nextstep.camp/c/R89PYi5H) 실습을 위한 지하철 노선도 애플리케이션

## 🚀 실습 - 단위 테스트 작성

### 요구사항

- 지하철 구간 관련 단위 테스트 작성하기
  - 구간 단위 테스트 (LineTest)
  - 구간 서비스 단위 테스트 with Mock (LineServiceMockTest)
  - 구간 서비스 단위 테스트 without Mock (LineServiceTest)
- 단위 테스트 기반으로 비즈니스 로직 리팩토링
  - 서비스 레이어의 비즈니스 로직 도메인으로 이동
  - 서비스 레이어의 DTO 변환 로직 컨트롤러와 Mapper로 이동
  - 구간 관련 기능은 별도 서비스로 분리
- 인수 테스트 리팩터링
  - 가독성을 위해 반복되는 코드 별도 클래스 / 메서드 분리

## 🚀 1단계 - 지하철 구간 추가 기능 개선

### 요구사항

#### 프로그래밍 요구사항

- ATDD 프로세스에 따라 기능 구현
  - 인수 조건 정의 -> 인수 테스트 작성 -> 기능 구현 (with. TDD)
  - 도메인 레이어 테스트는 필수
  - 서비스 레이어 테스트는 선택

#### 기능 요구사항

- 역 사이 새로운 역 등록
  - 상행역, 하행역 기준 모두 등록 가능
  - 신규 구간 추가 + 기존 구간 수정
  - 기존 구간의 길이는 기존 역 사이의 길이 - 신규 기간 길이로 변경됨
- 새로운 역을 상행 종점으로 등록
- 새로운 역을 하행 종점으로 등록
- 구간 추가가 불가능한 경우
  - 상행역, 하행역 모두 노선에 없는 경우
  - 상행역, 하행역 모두 노선에 있는 경우
  - 역 사이에 새로운 구간 등록 시, 기존 구간 길이보다 새로운 구간의 길이가 큰 경우

#### 인수 조건

```
Given 지하철역과 노선 생성 요청을 하고
When 지하철 노선에 새로운 역을 상행 종점으로 추가 요청하면
Then 노선에 새로운 구간이 추가 된다.

Given 지하철역과 노선 생성 요청을 하고
When 지하철 노선에 새로운 역을 하행 종점으로 추가 요청하면
Then 노선에 새로운 구간이 추가 된다.

Given 지하철역과 노선 생성 요청을 하고
When 지하철 노선에 역 사이에 새로운 구간을 추가 요청하면
Then 노선에 새로운 구간이 추가 된다.

Given 지하철역과 노선 생성 요청을 하고
When 지하철 노선에 상행역, 하행역이 모두 없는 구간 추가를 요청하면
Then 노선에 새로운 구간이 추가되지 않는다.

Given 지하철역과 노선 생성 요청을 하고
When 지하철 노선에 상행역, 하행역이 모두 있는 구간 추가를 요청하면
Then 노선에 새로운 구간이 추가되지 않는다.

Given 지하철역과 노선 생성 요청을 하고
When 지하철 노선에 신규 생성하는 구간의 길이가 기존 길이보다 크거나 같으면
Then 노선에 새로운 구간이 추가되지 않는다.
```

## 🚀 2단계 - 지하철 구간 제거 기능 개선

### 요구사항

- 모든 구간 삭제 가능
  - 종점 제거, 종점 직전 역이 종점으로 대체
  - 중간역 제거, 구간이 변경 되며, 거리는 두 구간의 합으로 변경
- 단, 구간이 하나인 경우 삭제 불가

### 인수 조건

```
Given 지하철역과 노선 생성 요청을 하고
When 구간이 하나인 경우 지하철역을 제거하면
Then 구간을 삭제할 수 없다.

Given 지하철역과 노선 생성 요청을 하고
Given 새로운 구간을 등록한 후
When 종점역을 삭제하면
Then 구간이 삭제되고, 종점이 직전역으로 바뀐다.

Given 지하철역과 노선 생성 요청을 하고
Given 새로운 구간을 등록한 후
When 중간역을 삭제하면
Then 구간이 변경되며, 거리는 두 구간의 합이 된다.
```

## 🚀 3단계 - 경로 조회 기능

### 요구사항

- 경로 조회 기능
  - Request : 출발역, 도착역 ID
  - Response : 경로 역 목록, 조회 경로 구간 거리
- 경로 조회가 불가능한 상황
  - 출발역과 도착역이 같은 경우
  - 출발역과 도착역이 연결되어 있지 않은 경우 (경로 null)
  - 출발역이나 도착역이 존재하지 않는 경우

### 인수 조건

```
Given 지하철역과 노선 생성 요청을 하고
When 출발역과 도착역이 같은 경로 조회를 하면
Then 경로 조회가 실패한다.

Given 지하철역과 노선 생성 요청을 하고
When 출발역과 도착역을 연결하는 경로가 없는 경우
Then 경로 조회가 실패한다.

Given 지하철역과 노선 생성 요청을 하고
When 출발역이나 도착역이 존재하지 않는 경우
Then 경로 조회가 실패한다.

Given 지하철역과 노선 생성 요청을 하고
When 출발역과 도착역을 지정해 경로 조회를 하면
Then 경로에 있는 역 목록과 조회 경로의 총거리가 나온다.
```